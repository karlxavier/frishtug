<%= form_with model: @registration, url: user_registrations_path(format: :js), id: 'sign_up_form' do |form| %>
  <div class="container-fluid px-0">
    <div id="registration-form" class="d-none">
      <form-wizard @on-complete="onComplete" step-size="xs" color="#562d07" ref="wizard">
        <h2 slot="title"></h2>
        <tab-content title="Plan">
          <%= render 'plan', form: form %>
        </tab-content>
        <tab-content title="Create Account" :before-change="accountValidations">
          <%= render 'create_account', form: form %>
        </tab-content>
        <tab-content title="Delivery Information" :before-change="addressValidations">
          <%= render 'delivery_information', { form: form, registration: @registration } %>
        </tab-content>
        <tab-content title="Days">
          <%= render 'days', { form: form, registration: @registration } %>
        </tab-content>
        <tab-content title="Payment Setup" :before-change="paymentValidations">
          <%= render 'payment_setup', form: form %>
        </tab-content>
        <tab-content title="Meals">
          <div style="position: relative">
            <div class="container">
              <%= render 'meals' %>
            </div>
            <%= render 'cart' %>
          </div>
        </tab-content>
        <tab-content title="Review Order">
          <div class="container-fluid">
            <%= render 'review_order', form: form %>
          </div>
        </tab-content>
        <template slot="footer" scope="props">
          <wizard-button
            @click.native="props.nextTab()"
            class="wizard-footer-right d-none">
            Next Step
          </wizard-button>
        </template>
      </form-wizard>
    </div>
  </div>
<% end %>

<%= content_for :header_js do %>
  <%= javascript_tag do %>
    window.onload = function() {
      var regForm = document.querySelector('#registration-form');
      if(regForm) {
        regForm.classList.remove('d-none');
      }
    }
    localStorage.setItem('current_date_est', '<%= Date.current %>');
    localStorage.setItem('tax_rate', <%= @tax_rate %>)
    localStorage.setItem('plans', '<%= raw @plan.to_json(only: %i[id name price shipping_fee interval limit minimum_credit_allowed for_type]) %>');
  <% end %>
  <%= javascript_pack_tag 'vue_registration_wizard', defer: true %>
<% end %>

<%= content_for :footer_js do %>
  <script type="text/javascript">
    <% if params[:plan_name] %>
      (function() {
        var plan_btn = document.querySelector('.<%= "#{params[:plan_name].parameterize}--radio_btn" %>');
        var click_event = new Event('click');
        plan_btn.dispatchEvent(click_event);
      })()
    <% end %>
  </script>
<% end %>
